---
title: Development
---

If you want to tweak CTF-Citadel to your own likings, or contribute to our codebase, you will need to have some things installed and setup.

## Preparing your Environment

There are a few things you will need to have installed.

- [Docker](https://docs.docker.com/get-docker/)
- [Node.js](https://nodejs.org/en/download)
- [git](https://git-scm.com/downloads)

If you are developing on Linux, you may be able to pull all of these through your distro's respectable package manager (`apt`, `yum`, `pacman`, ...).

Developing on Windows might hit some roadblocks when dealing with Docker, which can be circumvented by using a Virtual Machine, which can handle f.E. the PostgreSQL test instance.

## Deploying for Development

For tinkering with the Platform itself, one may want to spin up the dev profile in the provided `docker-compose.yaml`, to spin up a standalone PostgreSQL instance.

```bash
docker-compose --profile dev up -d --build
```

This database will then listen on `localhost:5432`, and can be accessed by starting the WebApp in development mode from the project root.

Be aware that the application still needs all the environment variables, which are otherwise provided by the `docker-compose.yaml` file. This can be done on Linux based systems like so:

Some are omitted and options are set, tailored to the fact that this will be used during development only.

```bash
INSTANCE_NAME='testCTF' \
EMAIL_SERVICE='hotmail' \
EMAIL_NAME='some@example.com' \
EMAIL_PASS='CHANGEME' \
DB_HOST='127.0.0.1' \
DB_NAME='citadel' \
DB_USER='root' \
DB_PASS='CHANGEME' \
BACKEND_HOST='127.0.0.1' \
BACKEND_PORT=8080 \
INFRA_HOST='some.infra.host' \
INFRA_PORT=8080 \
INFRA_PSK='CHANGEME' \
M0N1T0R_ENABLE=0 \
F1RSTBL00D_ENABLE=0 \
DISABLE_EMAIL_VERIFY=1 \
npm run dev
```

Or, if you are developing on a Windows based system like so:

```powershell
$env:INSTANCE_NAME="testCTF"
$env:EMAIL_SERVICE="hotmail"
$env:EMAIL_NAME='some@example.com' 
$env:EMAIL_PASS='CHANGEME'
$env:DB_HOST='127.0.0.1'
$env:DB_NAME='citadel'
$env:DB_USER='root'
$env:DB_PASS="CHANGEME"
$env:BACKEND_HOST="127.0.0.1" 
$env:BACKEND_PORT="8080"
$env:INFRA_HOST='some.infra.host'
$env:INFRA_PORT=8080
$env:INFRA_PSK='CHANGEME'
$env:M0N1T0R_ENABLE=0
$env:F1RSTBL00D_ENABLE=0
$env:DISABLE_EMAIL_VERIFY=1
npm run dev
```

:::caution
Above configuration purposely disables all integrations, except the infrastructure container backend.

If you need to test an integration specifically, refer to the full `docker-compose.yaml` to see how to enable it.
:::

This will start the Web Application in Astro's development mode. Since we check for this in the Authentication events, you will be able to interact, without actually logging in, since you are currently in a "Dummy Session".

```ts
// index.astro
import { DUMMY_SESSION } from '../lib/helpers';
// ...
let session = DUMMY_SESSION;

if (!import.meta.env.DEV) {
    // ...
    session = { ...Astro.locals.user };
}

<Layout title="CTF-Citadel">
    <Header
        username={session.username}
        interactive={true}
        admin={session.user_role == 'admin' ? true : false}
        client:visible
    />
    // ...
</Layout>
// ...
```

This allows you to tinker the platform more easily and adapt it to your needs. It will also automatically assign you the administrator `user_role`.

:::caution
**DO UNDER NO CIRRCUMSTANCES USE THE DEVELOPMENT MODE IN PRODUCTION OR ACTUAL CTF SCENARIOS!**
:::

## Developing User Features

The workflow for developing user specific function is to run the app in actual `dist` mode, which means it needs to be rebuilt everytime some changes are made.

This would look similar to the deployment via the `dev` command, only with the extra step of revuilding and substituting with `dist`.

```bash
# on changes
npm run build
# --- output ommited ---
# then run as dist
# same env vars
npm run dist
```

After the app is running and communicating with the database, you can create a test user and test the platform like a regular user interacting with it.

:::tip
Be sure to specify `DISABLE_EMAIL_VERIFY=1` as an environment variable when doing this, since it allows you to bypass the email verification process.
:::

___

Authors: Fabian T.